<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interview - CodePractice</title>
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <style>


    .editor-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border-color);
    }

    .editor-header {
      padding: 1rem;
      background-color: var(--surface-color);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .language-select {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      background-color: var(--bg-color);
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: 0.9rem;
    }

    .code-editor {
      flex: 1;
      padding: 1rem;
      border: none;
      outline: none;
      background-color: var(--code-bg);
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: 0.9rem;
      line-height: 1.5;
      resize: none;
      white-space: pre;
      overflow-wrap: normal;
      overflow-x: auto;
    }

    .editor-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .btn-secondary {
      background-color: var(--surface-light);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background-color: var(--border-color);
    }

    .btn-outline {
      background-color: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .btn-outline:hover {
      background-color: var(--surface-light);
      color: var(--text-primary);
      border-color: var(--primary-color);
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.8rem;
    }

    .results-container {
      height: 300px;
      border-top: 1px solid var(--border-color);
      background-color: var(--surface-color);
    }

    .results-header {
      padding: 1rem;
      background-color: var(--surface-light);
      border-bottom: 1px solid var(--border-color);
    }

    .results-tabs {
      display: flex;
      gap: 0;
    }

    .results-tab {
      padding: 0.5rem 1rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 0.85rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .results-tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }

    .results-content {
      flex: 1;
      overflow-y: auto;
    }

    .tab-panel {
      padding: 1rem;
    }

    .tab-panel.hidden {
      display: none;
    }

    .empty-state {
      text-align: center;
      padding: 2rem;
      color: var(--text-secondary);
    }

    .execution-result {
      background-color: var(--surface-color);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      overflow: hidden;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background-color: var(--surface-light);
      border-bottom: 1px solid var(--border-color);
    }

    .result-status {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .result-status.success {
      color: var(--success-color);
    }

    .result-status.error {
      color: var(--danger-color);
    }

    .result-time {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .result-output, .result-error {
      padding: 1rem;
    }

    .result-output h4, .result-error h4 {
      margin: 0 0 0.5rem 0;
      font-size: 0.9rem;
      color: var(--text-primary);
    }

    .result-output pre, .result-error pre {
      margin: 0;
      padding: 0.75rem;
      background-color: var(--code-bg);
      border-radius: 0.25rem;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      line-height: 1.4;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 300px;
      overflow-y: auto;
    }

    .error-text {
      color: var(--danger-color);
    }

    /* Resizable Layout */
    .problem-page {
      display: flex;
      height: calc(100vh - 65px);
      overflow: hidden;
      position: relative;
    }

    .problem-description {
      flex: 0 0 500px;
      min-width: 300px;
      max-width: 70vw;
      overflow-y: auto;
      padding: 1.5rem;
      border-right: 1px solid var(--border-color);
    }

    /* Responsive design */
    @media (max-width: 1200px) {
      .problem-description {
        flex-basis: 400px;
      }
    }

    @media (max-width: 900px) {
      .problem-description {
        flex-basis: 350px;
      }
    }

    @media (max-width: 768px) {
      .problem-page {
        flex-direction: column;
        height: auto;
      }

      .problem-description {
        flex-basis: auto;
        max-width: none;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        max-height: 40vh;
        padding: 1rem;
      }

      .resizer-vertical {
        display: none;
      }

      .resizer-horizontal {
        display: none;
      }

      .problem-workspace {
        flex: 1;
        min-height: 60vh;
      }

      .editor-container {
        flex-basis: calc(100% - 300px);
      }

      .results-container {
        flex-basis: 300px;
      }
    }

    .resizer-vertical {
      flex: 0 0 8px;
      background-color: var(--border-color);
      cursor: col-resize;
      transition: background-color 0.2s;
      position: relative;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .resizer-vertical::before {
      content: '';
      width: 4px;
      height: 40px;
      background-color: var(--border-color);
      border-radius: 2px;
    }

    .resizer-vertical:hover::before,
    .resizer-vertical.active::before {
      background-color: var(--primary-color);
    }

    .problem-workspace {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 400px;
    }

    .editor-container {
      flex: 1;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      height: calc(100% - 300px); /* Default height minus results container */
    }

    .results-container {
      height: 300px;
      min-height: 150px;
      max-height: 600px;
      border-top: 1px solid var(--border-color);
      background-color: var(--surface-color);
    }

    /* Problem Description Styles */
    .problem-textarea {
      width: 100%;
      min-height: 400px;
      padding: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      background-color: var(--code-bg);
      color: var(--text-primary);
      font-family: var(--font-mono);
      font-size: 0.9rem;
      line-height: 1.5;
      resize: vertical;
      outline: none;
    }

    .problem-textarea::placeholder {
      color: var(--text-secondary);
    }

    .problem-textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.1);
    }

    /* Resizers */
    .resizer-horizontal {
      flex: 0 0 8px;
      background-color: var(--border-color);
      cursor: row-resize;
      transition: background-color 0.2s;
      position: relative;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .resizer-horizontal::before {
      content: '';
      height: 4px;
      width: 40px;
      background-color: var(--border-color);
      border-radius: 2px;
    }

    .resizer-horizontal:hover::before,
    .resizer-horizontal.active::before {
      background-color: var(--primary-color);
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <a href="/" class="logo">
        <span class="logo-icon">⟨/⟩</span>
        CodePractice
      </a>
      <nav class="nav">
        <a href="/problems" class="nav-link">Problems</a>
        <a href="/interview" class="nav-link" style="color: var(--primary-color);">Interview</a>
        <a href="/bookmarks" class="nav-link">Bookmarks</a>
        <a href="/progress" class="nav-link">Progress</a>
        <a href="/timeline" class="nav-link">Timeline</a>
        <div id="auth-nav" class="hidden">
          <a href="/login" class="btn btn-secondary btn-sm">Log In</a>
          <a href="/signup" class="btn btn-primary btn-sm">Sign Up</a>
        </div>
        <div id="user-nav" class="user-info hidden">
          <span class="username">Welcome, <span id="nav-username"></span></span>
          <button onclick="handleLogout()" class="btn btn-secondary btn-sm">Log Out</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="problem-page">
    <!-- Problem Description Panel (Left Side) -->
    <div class="problem-description" id="problem-description">
      <div class="problem-header">
        <div class="problem-header-top">
          <div class="problem-header-left">
            <h1>Custom Problem</h1>
          </div>
        </div>
      </div>

      <div class="problem-content">
        <h3>Problem Description</h3>
        <textarea id="problem-textarea" class="problem-textarea" placeholder="Paste or type your coding problem here...

Example:
Given an array of integers nums and an integer target, return indices of the two numbers such that they add up to target.

You may assume that each input would have exactly one solution, and you may not use the same element twice.

You can return the answer in any order.

Example 1:
Input: nums = [2,7,11,15], target = 9
Output: [0,1]
Explanation: Because nums[0] + nums[1] == 9, we return [0, 1].

Constraints:
• 2 <= nums.length <= 104
• -109 <= nums[i] <= 109
• -109 <= target <= 109
• Only one valid answer exists."></textarea>
      </div>
    </div>

    <!-- Vertical Resizer -->
    <div class="resizer-vertical" id="vertical-resizer"></div>

    <!-- Code Editor Panel (Right Side) -->
    <div class="problem-workspace" id="problem-workspace">
      <div class="editor-container">
        <div class="editor-header">
          <select id="language-select" class="language-select">
            <option value="javascript">JavaScript</option>
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="cpp">C++</option>
            <option value="c">C</option>
            <option value="csharp">C#</option>
          </select>
          <div class="editor-actions">
            <button id="run-btn" class="btn btn-secondary btn-sm">
              ▶ Run Code
            </button>
            <button id="reset-btn" class="btn btn-outline btn-sm" title="Reset code to default starter template">
              ↺ Reset Code
            </button>
          </div>
        </div>
        <textarea id="code-editor" class="code-editor" spellcheck="false" placeholder="// Start coding here...
// Choose your language above
// This is a blank IDE for interview practice"></textarea>
      </div>

      <!-- Horizontal Resizer -->
      <div class="resizer-horizontal" id="horizontal-resizer"></div>

      <!-- Results Panel -->
      <div class="results-container" id="results-container">
        <div class="results-header">
          <h4 style="margin: 0; color: var(--text-primary);">Output</h4>
        </div>
        <div class="results-content">
          <div id="tab-output" class="tab-panel">
            <div class="empty-state">
              <p>Output will appear here when you run code</p>
              <p style="font-size: 0.8rem; margin-top: 0.5rem;">Click "Run Code" to execute your program</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="/js/api.js"></script>
  <script>
    // DOM Elements
    const languageSelect = document.getElementById('language-select');
    const codeEditor = document.getElementById('code-editor');
    const runBtn = document.getElementById('run-btn');
    const resetBtn = document.getElementById('reset-btn');
    const outputTab = document.getElementById('tab-output');

    // Track previous language for reverting on cancel
    let previousLanguage = languageSelect.value;

    // Default starter code for each language
    const starterCode = {
      javascript: `// JavaScript
console.log('Hello, World!');

function example() {
    // Your code here
}

// Call your function
example();`,
      python: `# Python
print('Hello, World!')

def example():
    # Your code here
    pass

# Call your function
example()`,
      java: `// Java
public class Main {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
        
        // Your code here
    }
}`,
      cpp: `// C++
#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    
    // Your code here
    
    return 0;
}`,
      c: `// C
#include <stdio.h>

int main() {
    printf("Hello, World!\\n");
    
    // Your code here
    
    return 0;
}`,
      csharp: `// C#
using System;

class Program {
    static void Main(string[] args) {
        Console.WriteLine("Hello, World!");
        
        // Your code here
    }
}`
    };

    // Language switching
    languageSelect.addEventListener('change', () => {
      const newLang = languageSelect.value;
      const currentCode = codeEditor.value.trim();

      // Check if current code is custom (not matching any starter code)
      const isStarterCode = Object.values(starterCode).some(
        starter => starter && currentCode === starter.trim()
      );

      if (!currentCode || isStarterCode) {
        // Code is empty or default, safe to switch
        codeEditor.value = starterCode[newLang];
        previousLanguage = newLang;
      } else {
        // Code is custom, show confirmation
        const confirmed = confirm(
          `You have custom code written in ${previousLanguage.toUpperCase()}. ` +
          `Switching to ${newLang.toUpperCase()} will reset your code to the default template. ` +
          `Are you sure you want to continue?`
        );

        if (confirmed) {
          // User confirmed, switch language and reset code
          codeEditor.value = starterCode[newLang];
          previousLanguage = newLang;
          showToast('success', 'Language Switched', `Switched to ${newLang.toUpperCase()} and reset code to default template.`);
        } else {
          // User cancelled, revert language selection
          languageSelect.value = previousLanguage;
        }
      }
    });

    // Initialize with JavaScript
    codeEditor.value = starterCode.javascript;
    previousLanguage = 'javascript';

    // Handle Tab key in editor
    codeEditor.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        e.preventDefault();
        const start = codeEditor.selectionStart;
        const end = codeEditor.selectionEnd;
        codeEditor.value = codeEditor.value.substring(0, start) + '  ' + codeEditor.value.substring(end);
        codeEditor.selectionStart = codeEditor.selectionEnd = start + 2;
      }
    });

    // Run code
    runBtn.addEventListener('click', async () => {
      if (!currentUser) {
        alert('Please log in to run code');
        window.location.href = '/login';
        return;
      }

      runBtn.disabled = true;
      runBtn.innerHTML = '<span class="spinner"></span> Running...';

      try {
        const result = await API.runInterviewCode(codeEditor.value, languageSelect.value);
        displayInterviewResult(result);
      } catch (error) {
        displayInterviewResult({
          success: false,
          error: error.message,
          output: '',
          runtime: 0,
          memory: 0
        });
      } finally {
        runBtn.disabled = false;
        runBtn.innerHTML = '▶ Run Code';
      }
    });

    // Reset code
    resetBtn.addEventListener('click', () => {
      const currentLang = languageSelect.value;
      const currentCode = codeEditor.value.trim();
      const defaultCode = starterCode[currentLang];

      // Check if code is already the default
      if (currentCode === defaultCode.trim()) {
        showToast('info', 'Already Default', 'The code is already set to the default template.');
        return;
      }

      // Show confirmation dialog
      if (confirm('Are you sure you want to reset the code? This will discard all your changes and restore the default starter template for the current language.')) {
        codeEditor.value = defaultCode;
        showToast('success', 'Code Reset', 'Code has been reset to the default template.');
      }
    });

    function displayInterviewResult(result) {
      if (result.success) {
        outputTab.innerHTML = `
          <div class="execution-result">
            <div class="result-header">
              <span class="result-status success">✓ Success</span>
              <span class="result-time">${result.runtime}ms</span>
            </div>
            <div class="result-output">
              <h4>Output:</h4>
              <pre>${escapeHtml(result.output || 'No output')}</pre>
            </div>
          </div>
        `;
      } else {
        outputTab.innerHTML = `
          <div class="execution-result">
            <div class="result-header">
              <span class="result-status error">✗ Error</span>
              <span class="result-time">${result.runtime}ms</span>
            </div>
            <div class="result-error">
              <h4>Error:</h4>
              <pre class="error-text">${escapeHtml(result.error)}</pre>
            </div>
            ${result.output ? `
            <div class="result-output">
              <h4>Output:</h4>
              <pre>${escapeHtml(result.output)}</pre>
            </div>
            ` : ''}
          </div>
        `;
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ==================== RESIZABLE PANELS ====================

    // Vertical resizer (left/right panels)
    const verticalResizer = document.getElementById('vertical-resizer');
    const problemDescription = document.getElementById('problem-description');
    const problemWorkspace = document.getElementById('problem-workspace');

    let isVerticalResizing = false;
    let startX, startWidth;

    verticalResizer.addEventListener('mousedown', (e) => {
      isVerticalResizing = true;
      startX = e.clientX;
      startWidth = problemDescription.offsetWidth;
      verticalResizer.classList.add('active');
      document.body.style.cursor = 'col-resize';
      document.body.style.userSelect = 'none';
      e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isVerticalResizing) return;

      const deltaX = e.clientX - startX;
      const newWidth = startWidth + deltaX;
      const containerWidth = document.querySelector('.problem-page').offsetWidth;

      // Constrain width between 300px and 80% of container
      const minWidth = 300;
      const maxWidth = Math.min(containerWidth * 0.8, containerWidth - 400); // Leave room for right panel

      if (newWidth >= minWidth && newWidth <= maxWidth) {
        problemDescription.style.flexBasis = newWidth + 'px';
      }
    });

    document.addEventListener('mouseup', () => {
      if (isVerticalResizing) {
        isVerticalResizing = false;
        verticalResizer.classList.remove('active');
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
      }
    });

    // Horizontal resizer (editor/output panels)
    const horizontalResizer = document.getElementById('horizontal-resizer');
    const editorContainer = document.querySelector('.editor-container');
    const resultsContainer = document.getElementById('results-container');

    let isHorizontalResizing = false;
    let startY, startHeight;

    horizontalResizer.addEventListener('mousedown', (e) => {
      isHorizontalResizing = true;
      startY = e.clientY;
      startHeight = resultsContainer.offsetHeight;
      horizontalResizer.classList.add('active');
      document.body.style.cursor = 'row-resize';
      document.body.style.userSelect = 'none';
      e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isHorizontalResizing) return;

      const deltaY = startY - e.clientY; // Inverted because we want to resize from bottom
      const newHeight = startHeight + deltaY;
      const containerHeight = problemWorkspace.offsetHeight;

      // Constrain height between min and max
      const minHeight = 150;
      const maxHeight = Math.min(containerHeight * 0.8, 600);

      if (newHeight >= minHeight && newHeight <= maxHeight) {
        resultsContainer.style.flexBasis = newHeight + 'px';
        // Remove flex from editor container to allow proper sizing
        editorContainer.style.flex = 'none';
        editorContainer.style.height = `calc(100% - ${newHeight + 8}px)`; // Account for resizer
      }
    });

    document.addEventListener('mouseup', () => {
      if (isHorizontalResizing) {
        isHorizontalResizing = false;
        horizontalResizer.classList.remove('active');
        document.body.style.cursor = '';
        document.body.style.userSelect = '';
      }
    });
  </script>
</body>
</html>